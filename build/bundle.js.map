{"version":3,"sources":["webpack:///webpack/bootstrap 5ae8c66708144fd3248f","webpack:///external \"babel-polyfill\"","webpack:///./src/main.js","webpack:///external \"xmlhttprequest\"","webpack:///./src/websql.js","webpack:///external \"immediate\"","webpack:///./src/SQLiteDatabase.js","webpack:///external \"sqlite3\"","webpack:///./src/SQLiteResult.js","webpack:///./src/PGDatabase.js","webpack:///external \"pg-pool\"","webpack:///./src/WebSQLDatabase.js","webpack:///external \"tiny-queue\"","webpack:///external \"noop-fn\"","webpack:///./src/WebSQLTransaction.js","webpack:///./src/WebSQLResultSet.js","webpack:///external \"azure-mobile-apps-client\""],"names":["Pazure","option","global","cordova","version","process","versions","node","XMLHttpRequest","window","sqlitePlugin","openDatabase","WindowsAzure","require","client","MobileServiceClient","azureConnStr","syncContext","push","promise_resolve","promise_reject","p","Promise","resolve","reject","read","then","items","length","n","i","map","item","del","id","bind","tableOption","store","MobileServiceSqliteStore","localStoreConfig","defineTable","getSyncContext","initialize","console","log","table","getSyncTable","name","getRecordCount","clear","sync","pushHandler","onConflict","serverRecord","clientRecord","pushError","getError","message","cancelAndDiscard","onError","tableName","getTable","options","success_callback","error_callback","createDb","dbName","dbVersion","database","adapter","SQLiteDatabase","PGDatabase","WebSQLDatabase","location","db","sqlite3","SQLiteResult","READ_ONLY_ERROR","Error","_db","Database","runSelect","sql","args","cb","all","err","rows","insertId","rowsAffected","resultSet","runNonSelect","run","executionResult","lastID","changes","prototype","exec","queries","readOnly","callback","len","results","Array","checkDone","doNext","onQueryComplete","res","query","isSelect","test","isTableInfo","module","exports","error","pgPool","matches","match","result","rowCount","replace","search","split","slice","join","k","Queue","immediate","noop","WebSQLTransaction","ROLLBACK","COMMIT","TransactionTask","txnCallback","errorCallback","successCallback","_txnQueue","_running","_currentTask","_onTransactionComplete","self","done","_runNextTransaction","_runTransaction","txn","_checkDone","task","shift","_createTransaction","transaction","readTransaction","executeSql","tran","WebSQLResultSet","errorUnhandled","massageSQLResult","SQLTask","sqlCallback","sqlErrorCallback","runBatch","batch","onDone","runAllSql","_websqlDatabase","_error","batchTask","_complete","_sqlQueue","_runningTimeout","websqlDatabase","isArray","WebSQLRows","array","_array"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5ae8c66708144fd3248f","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 1\n// module chunks = 0","import xmlhttprequest from \"xmlhttprequest\";\nimport { openDatabase } from \"./websql\";\nimport immediate from 'immediate';\n\nclass Pazure {\n  constructor(option) {\n    this.option = option;\n\n    global.cordova = {version: global.process.versions.node};\n    global.XMLHttpRequest = xmlhttprequest.XMLHttpRequest;\n    global.window = {sqlitePlugin: {openDatabase: openDatabase}};\n\n    //cannot import this at the global level, because this is loaded dynamicly, according to if cordova is set\n    this.WindowsAzure =  require('azure-mobile-apps-client');\n    this.client = new this.WindowsAzure.MobileServiceClient(option.azureConnStr);\n  }\n\n  push() {\n    return this.syncContext.push();\n  }\n\n  getRecordCount(){\n    var promise_resolve, promise_reject, p = new Promise(function (resolve, reject) { promise_resolve = resolve; promise_reject = reject; });\n    this.read().then(function(items){\n      promise_resolve(items.length);\n    });\n    return p;\n  };\n\n  clear(){\n    var promise_resolve, promise_reject, p = new Promise(function (resolve, reject) { promise_resolve = resolve; promise_reject = reject; });\n    this.read().then(function(items){\n      //this only works for small dataset, for testing is ok\n      //for large dataset need to partation them and delete by block\n      var n = items.length;\n      if (n == 0) {\n        immediate(function(){\n          promise_resolve(0);\n        });\n      } else{\n        var i = 0;\n        items.map(function(item){\n          //console.log(\"delete \"+item.id);\n          this.del({id: item.id}).then(function(){\n            i++;\n            if (i==n) promise_resolve(n);\n          });\n        }.bind(this));\n      }\n    }.bind(this));\n\n    return p;\n  };\n\n  getOfflineTable(tableOption) {\n    this.tableOption = tableOption;\n    this.store = new this.WindowsAzure.MobileServiceSqliteStore(this.option.localStoreConfig);\n    this.store.defineTable(this.tableOption);\n    this.syncContext = this.client.getSyncContext();\n\n    var promise_resolve, promise_reject, p = new Promise(function (resolve, reject) { promise_resolve = resolve; promise_reject = reject; });\n\n    this.syncContext.initialize(this.store).then(function(){\n      console.log(\"initialize success\");\n\n      var table = this.client.getSyncTable(this.tableOption.name);\n      if (typeof table.getRecordCount == \"undefined\") table.getRecordCount = this.getRecordCount;\n      if (typeof table.clear == \"undefined\") table.clear = this.clear;\n      if (typeof table.sync == \"undefined\") table.sync = this.sync;\n\n      this.syncContext.pushHandler = {\n        onConflict: function (serverRecord, clientRecord, pushError) {\n          console.log(\"Sync conflict! \" + pushError.getError().message);\n          pushError.cancelAndDiscard();\n        },\n        onError: function (pushError) {\n          console.log(\"Sync error! \" + pushError.getError().message);\n        }\n      };\n\n      promise_resolve(table);\n    }.bind(this));\n\n    return p;\n  }\n\n  getOnlineTable(tableName) {\n    var table = this.client.getTable(tableName)\n    if (typeof table.getRecordCount == \"undefined\") table.getRecordCount = this.getRecordCount;\n    if (typeof table.clear == \"undefined\") table.clear = this.clear;\n    return table;\n  }\n}\n\nexport { Pazure };\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js","module.exports = require(\"xmlhttprequest\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"xmlhttprequest\"\n// module id = 3\n// module chunks = 0","'use strict';\nimport immediate from 'immediate';\n\nfunction openDatabase(options, success_callback, error_callback) {\n  function createDb(dbName, dbVersion) {\n    var database;\n    if (dbName.adapter == 'sqlite3'){\n      var SQLiteDatabase = require('./SQLiteDatabase');\n      database = new SQLiteDatabase(dbName.database);\n    }else if (dbName.adapter == 'pg'){\n      var PGDatabase = require('./PGDatabase');\n      database = new PGDatabase(dbName);\n    }\n\n    var WebSQLDatabase = require('./WebSQLDatabase');\n    return new WebSQLDatabase(dbVersion, database);\n  }\n\n  var dbName = options.name;\n  var location = options.location;\n\n  var db = createDb(dbName);\n\n  immediate(function () {\n    success_callback(db);\n  });\n\n  return db;\n}\n\nexport { openDatabase };\n\n\n\n// WEBPACK FOOTER //\n// ./src/websql.js","module.exports = require(\"immediate\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"immediate\"\n// module id = 5\n// module chunks = 0","'use strict';\n\nvar sqlite3 = require('sqlite3');\nvar SQLiteResult = require('./SQLiteResult');\n\nvar READ_ONLY_ERROR = new Error(\n  'could not prepare statement (23 not authorized)');\n\nfunction SQLiteDatabase(name) {\n  this._db = new sqlite3.Database(name);\n}\n\nfunction runSelect(db, sql, args, cb) {\n  db.all(sql, args, function (err, rows) {\n    if (err) {\n      return cb(new SQLiteResult(err));\n    }\n    var insertId = void 0;\n    var rowsAffected = 0;\n    var resultSet = new SQLiteResult(null, insertId, rowsAffected, rows);\n    cb(resultSet);\n  });\n}\n\nfunction runNonSelect(db, sql, args, cb) {\n  db.run(sql, args, function (err) {\n    if (err) {\n      return cb(new SQLiteResult(err));\n    }\n    /* jshint validthis:true */\n    var executionResult = this;\n    var insertId = executionResult.lastID;\n    var rowsAffected = executionResult.changes;\n    var rows = [];\n    var resultSet = new SQLiteResult(null, insertId, rowsAffected, rows);\n    cb(resultSet);\n  });\n}\n\nSQLiteDatabase.prototype.exec = function exec(queries, readOnly, callback) {\n  var db = this._db;\n  var len = queries.length;\n  var results = new Array(len);\n\n  var i = 0;\n\n  function checkDone() {\n    if (++i === len) {\n      callback(null, results);\n    } else {\n      doNext();\n    }\n  }\n\n  function onQueryComplete(i) {\n    return function (res) {\n      results[i] = res;\n      checkDone();\n    };\n  }\n\n  function doNext() {\n    var query = queries[i];\n    var sql = query.sql;\n    var args = query.args;\n\n    //console.log(\"SQL: \" + sql);\n\n    // TODO: It seems like the node-sqlite3 API either allows:\n    // 1) all(), which returns results but not rowsAffected or lastID\n    // 2) run(), which doesn't return results, but returns rowsAffected and lastID\n    // So we try to sniff whether it's a SELECT query or not.\n    // This is inherently error-prone, although it will probably work in the 99%\n    // case.\n    var isSelect = /^\\s*SELECT\\b/i.test(sql);\n    var isTableInfo = /^\\s*PRAGMA\\s*table_info\\b/i.test(sql);\n\n    if (readOnly && !isSelect) {\n      onQueryComplete(i)(new SQLiteResult(READ_ONLY_ERROR));\n    } else if (isSelect || isTableInfo) {\n      runSelect(db, sql, args, onQueryComplete(i));\n    } else {\n      runNonSelect(db, sql, args, onQueryComplete(i));\n    }\n  }\n\n  doNext();\n};\n\nmodule.exports = SQLiteDatabase;\n\n\n\n// WEBPACK FOOTER //\n// ./src/SQLiteDatabase.js","module.exports = require(\"sqlite3\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sqlite3\"\n// module id = 7\n// module chunks = 0","'use strict';\n\nfunction SQLiteResult(error, insertId, rowsAffected, rows) {\n  this.error = error;\n  this.insertId = insertId;\n  this.rowsAffected = rowsAffected;\n  this.rows = rows;\n}\n\nmodule.exports = SQLiteResult;\n\n\n// WEBPACK FOOTER //\n// ./src/SQLiteResult.js","'use strict';\n\nvar pgPool = require('pg-pool');\nvar SQLiteResult = require('./SQLiteResult');\n\nvar READ_ONLY_ERROR = new Error(\n  'could not prepare statement (23 not authorized)');\n\nfunction PGDatabase(name) {\n  this._db = new pgPool(name);\n}\n\nfunction runSelect(db, sql, args, cb) {\n  var matches = sql.match(/PRAGMA\\s*table_info\\((.*)\\)\\;/);\n  if (matches && matches[1]){\n    var tableName = matches[1];\n\n    sql = \"select ordinal_position as cid, \\\n    c.column_name as name, \\\n    data_type as type, \\\n    case when is_nullable='YES' then 0 else 1 end as notnull, \\\n    column_default as dflt_value, \\\n    tc.pk \\\n    from information_schema.columns c \\\n    left join (select tc.table_name as table_name, ccu.column_name as column_name, 1 as pk from information_schema.table_constraints tc join information_schema.constraint_column_usage ccu \\\n\t  on tc.table_name=ccu.table_name and tc.constraint_name=ccu.constraint_name) tc \\\n\t  on c.table_name = tc.table_name and c.column_name = tc.column_name \\\n    where c.table_name='\" + tableName + \"';\"\n  }\n\n  db.query(sql, args, function(err, result) {\n    if (err) {\n      return cb(new SQLiteResult(err));\n    }\n    var insertId = void 0;\n    var rowsAffected = result.rowCount;\n    var resultSet = new SQLiteResult(null, insertId, rowsAffected, result.rows);\n    cb(resultSet);\n  });\n}\n\nfunction runNonSelect(db, sql, args, cb) {\n  //console.log(sql);\n\n  db.query(sql, args, function(err, rows) {\n    if (err) {\n      return cb(new SQLiteResult(err));\n    }\n    var insertId = 0;\n    if (rows.length == 0) insertId = 0;\n    var rowsAffected = rows.length;\n    var resultSet = new SQLiteResult(null, insertId, rowsAffected, rows);\n    cb(resultSet);\n  });\n}\n\nPGDatabase.prototype.exec = function exec(queries, readOnly, callback) {\n\n  var db = this._db;\n  var len = queries.length;\n  var results = new Array(len);\n\n  var i = 0;\n\n  function checkDone() {\n    if (++i === len) {\n      callback(null, results);\n    } else {\n      doNext();\n    }\n  }\n\n  function onQueryComplete(i) {\n    return function (res) {\n      results[i] = res;\n      checkDone();\n    };\n  }\n\n  function doNext() {\n    var query = queries[i];\n    var sql = query.sql;\n    var args = query.args;\n\n    sql = sql.replace(/\\[|\\]/g, '');\n    sql = sql.replace(/@p/g, '$');\n    sql = sql.replace(/COLLATE NOCASE/g, '');\n\n    if (sql.search(/\\s+OR\\s+IGNORE\\s+/)!=-1){\n      if (sql.split(';').length > 1) {//end with ;\n        sql = sql.split(';').slice(0, -1).join(';');\n      }\n      sql = sql.replace(/OR\\s+IGNORE\\s+/, '') + ' ON CONFLICT DO NOTHING ;';\n    }\n\n    var k = 1;\n    while(sql.search(/\\s*\\?\\s*/)!=-1) {sql = sql.replace('?', '$'+k); k++;}\n    //console.log(sql);\n    //console.dir(args);\n    // TODO: It seems like the node-sqlite3 API either allows:\n    // 1) all(), which returns results but not rowsAffected or lastID\n    // 2) run(), which doesn't return results, but returns rowsAffected and lastID\n    // So we try to sniff whether it's a SELECT query or not.\n    // This is inherently error-prone, although it will probably work in the 99%\n    // case.\n    var isSelect = /^\\s*SELECT\\b/i.test(sql);\n    var isTableInfo = /^\\s*PRAGMA\\s*table_info\\b/i.test(sql);\n\n    //console.log(\"SQL:\" + sql);\n    if (readOnly && !isSelect) {\n      onQueryComplete(i)(new SQLiteResult(READ_ONLY_ERROR));\n    } else if (isSelect || isTableInfo) {\n      runSelect(db, sql, args, onQueryComplete(i));\n    } else {\n      runNonSelect(db, sql, args, onQueryComplete(i));\n    }\n  }\n\n  doNext();\n};\n\nmodule.exports = PGDatabase;\n\n\n\n// WEBPACK FOOTER //\n// ./src/PGDatabase.js","module.exports = require(\"pg-pool\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pg-pool\"\n// module id = 10\n// module chunks = 0","'use strict';\n\nvar Queue = require('tiny-queue');\nvar immediate = require('immediate');\nvar noop = require('noop-fn');\n\nvar WebSQLTransaction = require('./WebSQLTransaction');\n\nvar ROLLBACK = [\n  {sql: 'ROLLBACK;', args: []}\n];\n\nvar COMMIT = [\n  {sql: 'END;', args: []}\n];\n\n// v8 likes predictable objects\nfunction TransactionTask(readOnly, txnCallback, errorCallback, successCallback) {\n  this.readOnly = readOnly;\n  this.txnCallback = txnCallback;\n  this.errorCallback = errorCallback;\n  this.successCallback = successCallback;\n}\n\nfunction WebSQLDatabase(dbVersion, db) {\n  this.version = dbVersion;\n  this._db = db;\n  this._txnQueue = new Queue();\n  this._running = false;\n  this._currentTask = null;\n}\n\nWebSQLDatabase.prototype._onTransactionComplete = function(err) {\n  var self = this;\n\n  function done() {\n    if (err) {\n      self._currentTask.errorCallback(err);\n    } else {\n      self._currentTask.successCallback();\n    }\n    self._running = false;\n    self._currentTask = null;\n    self._runNextTransaction();\n  }\n\n  if (self._currentTask.readOnly) {\n    done(); // read-only doesn't require a transaction\n  } else if (err) {\n    self._db.exec(ROLLBACK, false, done);\n  } else {\n    self._db.exec(COMMIT, false, done);\n  }\n};\n\nWebSQLDatabase.prototype._runTransaction = function () {\n  var self = this;\n  var txn = new WebSQLTransaction(self);\n\n  immediate(function () {\n    self._currentTask.txnCallback(txn);\n    txn._checkDone();\n  });\n};\n\nWebSQLDatabase.prototype._runNextTransaction = function() {\n  if (this._running) {\n    return;\n  }\n  var task = this._txnQueue.shift();\n\n  if (!task) {\n    return;\n  }\n\n  this._currentTask = task;\n  this._running = true;\n  this._runTransaction();\n};\n\nWebSQLDatabase.prototype._createTransaction = function(\n    readOnly, txnCallback, errorCallback, successCallback) {\n  errorCallback = errorCallback || noop;\n  successCallback = successCallback || noop;\n\n  if (typeof txnCallback !== 'function') {\n    throw new Error('The callback provided as parameter 1 is not a function.');\n  }\n\n  this._txnQueue.push(new TransactionTask(readOnly, txnCallback, errorCallback, successCallback));\n  this._runNextTransaction();\n};\n\nWebSQLDatabase.prototype.transaction = function (txnCallback, errorCallback, successCallback) {\n  this._createTransaction(false, txnCallback, errorCallback, successCallback);\n};\n\nWebSQLDatabase.prototype.readTransaction = function (txnCallback, errorCallback, successCallback) {\n  this._createTransaction(true, txnCallback, errorCallback, successCallback);\n};\n\nWebSQLDatabase.prototype.executeSql = function (sql, args, txnCallback, errorCallback) {\n  this.transaction(function(tran){\n    tran.executeSql(sql, args, function(transaction, result){\n      txnCallback(result);\n    }, errorCallback);\n  });\n};\n\nmodule.exports = WebSQLDatabase;\n\n\n\n// WEBPACK FOOTER //\n// ./src/WebSQLDatabase.js","module.exports = require(\"tiny-queue\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tiny-queue\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"noop-fn\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"noop-fn\"\n// module id = 13\n// module chunks = 0","'use strict';\n\nvar noop = require('noop-fn');\nvar Queue = require('tiny-queue');\nvar immediate = require('immediate');\nvar WebSQLResultSet = require('./WebSQLResultSet');\n\nfunction errorUnhandled() {\n  return true; // a non-truthy return indicates error was handled\n}\n\n// WebSQL has some bizarre behavior regarding insertId/rowsAffected. To try\n// to match the observed behavior of Chrome/Safari as much as possible, we\n// sniff the SQL message to try to massage the returned insertId/rowsAffected.\n// This helps us pass the tests, although it's error-prone and should\n// probably be revised.\nfunction massageSQLResult(sql, insertId, rowsAffected, rows) {\n  if (/^\\s*UPDATE\\b/i.test(sql)) {\n    // insertId is always undefined for \"UPDATE\" statements\n    insertId = void 0;\n  } else if (/^\\s*CREATE\\s+TABLE\\b/i.test(sql)) {\n    // WebSQL always returns an insertId of 0 for \"CREATE TABLE\" statements\n    insertId = 0;\n    rowsAffected = 0;\n  } else if (/^\\s*DROP\\s+TABLE\\b/i.test(sql)) {\n    // WebSQL always returns insertId=undefined and rowsAffected=0\n    // for \"DROP TABLE\" statements. Go figure.\n    insertId = void 0;\n    rowsAffected = 0;\n  } else if (!/^\\s*INSERT\\b/i.test(sql)) {\n    // for all non-inserts (deletes, etc.) insertId is always undefined\n    // Â¯\\_(ãƒ„)_/Â¯\n    insertId = void 0;\n  }\n  return new WebSQLResultSet(insertId, rowsAffected, rows);\n}\n\nfunction SQLTask(sql, args, sqlCallback, sqlErrorCallback) {\n  this.sql = sql;\n  this.args = args;\n  this.sqlCallback = sqlCallback;\n  this.sqlErrorCallback = sqlErrorCallback;\n}\n\nfunction runBatch(self, batch) {\n\n  function onDone() {\n    self._running = false;\n    runAllSql(self);\n  }\n\n  var readOnly = self._websqlDatabase._currentTask.readOnly;\n\n  self._websqlDatabase._db.exec(batch, readOnly, function (err, results) {\n    /* istanbul ignore next */\n    if (err) {\n      self._error = err;\n      return onDone();\n    }\n    for (var i = 0; i < results.length; i++) {\n      var res = results[i];\n      var batchTask = batch[i];\n      if (res.error) {\n        if (batchTask.sqlErrorCallback(self, res.error)) {\n          // user didn't handle the error\n          self._error = res.error;\n          return onDone();\n        }\n      } else {\n        batchTask.sqlCallback(self, massageSQLResult(\n          batch[i].sql, res.insertId, res.rowsAffected, res.rows));\n      }\n    }\n    onDone();\n  });\n}\n\nfunction runAllSql(self) {\n  if (self._running || self._complete) {\n    return;\n  }\n  if (self._error) {\n    self._complete = true;\n    return self._websqlDatabase._onTransactionComplete(self._error);\n  }\n  if (!self._sqlQueue.length) {\n    self._complete = true;\n    return self._websqlDatabase._onTransactionComplete();\n  }\n  self._running = true;\n  var batch = [];\n  var task;\n  while ((task = self._sqlQueue.shift())) {\n    batch.push(task);\n  }\n  runBatch(self, batch);\n}\n\nfunction executeSql(self, sql, args, sqlCallback, sqlErrorCallback) {\n  self._sqlQueue.push(new SQLTask(sql, args, sqlCallback, sqlErrorCallback));\n  if (self._runningTimeout) {\n    return;\n  }\n  self._runningTimeout = true;\n  immediate(function () {\n    self._runningTimeout = false;\n    runAllSql(self);\n  });\n}\n\nfunction WebSQLTransaction(websqlDatabase) {\n  this._websqlDatabase = websqlDatabase;\n  this._error = null;\n  this._complete = false;\n  this._runningTimeout = false;\n  this._sqlQueue = new Queue();\n  if (!websqlDatabase._currentTask.readOnly) {\n    // Since we serialize all access to the database, there is no need to\n    // run read-only tasks in a transaction. This is a perf boost.\n    this._sqlQueue.push(new SQLTask('BEGIN;', [], noop, noop));\n  }\n}\n\nWebSQLTransaction.prototype.executeSql = function (sql, args, sqlCallback, sqlErrorCallback) {\n  args = Array.isArray(args) ? args : [];\n  sqlCallback = typeof sqlCallback === 'function' ? sqlCallback : noop;\n  sqlErrorCallback = typeof sqlErrorCallback === 'function' ? sqlErrorCallback : errorUnhandled;\n\n  executeSql(this, sql, args, sqlCallback, sqlErrorCallback);\n};\n\nWebSQLTransaction.prototype._checkDone = function () {\n  runAllSql(this);\n};\n\nmodule.exports = WebSQLTransaction;\n\n\n\n// WEBPACK FOOTER //\n// ./src/WebSQLTransaction.js","'use strict';\n\nfunction WebSQLRows(array) {\n  this._array = array;\n  this.length = array.length;\n}\n\nWebSQLRows.prototype.item = function (i) {\n  return this._array[i];\n};\n\nfunction WebSQLResultSet(insertId, rowsAffected, rows) {\n  this.insertId = insertId;\n  this.rowsAffected = rowsAffected;\n  this.rows = new WebSQLRows(rows);\n}\n\nmodule.exports = WebSQLResultSet;\n\n\n\n// WEBPACK FOOTER //\n// ./src/WebSQLResultSet.js","module.exports = require(\"azure-mobile-apps-client\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"azure-mobile-apps-client\"\n// module id = 16\n// module chunks = 0"],"sourceRoot":""}